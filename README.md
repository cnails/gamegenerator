# 2D Roguelike Game

Проект 2D roguelike игры на Python с использованием pygame-ce.

## Системные требования

- **ОС**: Windows 7+, macOS 10.13+, Linux (Ubuntu 18.04+)
- **Python**: 3.10 или выше
- **ОЗУ**: минимум 512 MB
- **Видеокарта**: любая с поддержкой OpenGL 2.0+
- **Место на диске**: ~50 MB

## Установка

1. Клонируйте репозиторий или скачайте проект.

2. Установите зависимости:

```bash
pip install -r requirements.txt
```

## Запуск

Запустите игру командой:

```bash
python -m game
```

Или напрямую:

```bash
python -m game.main
```

## Управление

### Основное управление

- **WASD** или **Стрелки** — движение (диагональное с нормализацией)
- **Shift** — перекат/рывок (инвулн, кулдаун 1.2с)
- **J** — атака текущим оружием
- **Q / E** — переключение оружия (меч → копьё → арбалет)
- **K** — использование зелья лечения (кулдаун 10с)
- **I** — открыть/закрыть инвентарь
- **ESC** — пауза (в меню — выход)

### Оружие

- **Меч** — удар по дуге (радиус 60px, быстрая атака)
- **Копьё** — тычок вперёд (радиус 90px, пробивает 1 врага)
- **Арбалет** — дальнобойный болт (радиус 400px, перезарядка 1.5с)

### В бою

- Используйте **Shift** для уклонения от атак
- Переключайтесь между оружием в зависимости от ситуации
- Следите за телеграфами босса (красные индикаторы на полу)
- Используйте зелья лечения своевременно

## Советы для новичков

### Базовые стратегии

1. **Движение**: Двигайтесь диагонально для большей скорости. Используйте рывок (Shift) для уклонения от опасных атак.

2. **Оружие**:
   - Меч — для ближнего боя против слабых врагов
   - Копьё — для пробивания нескольких врагов в ряд
   - Арбалет — для безопасной атаки на расстоянии

3. **Бой с врагами**:
   - **Гоблины**: Быстрые, могут уклоняться. Атакуйте после их рывка.
   - **Слизни**: Медленные, но наносят контактный урон. Избегайте луж, которые они оставляют.
   - **Босс**: Следите за телеграфами (красные индикаторы). Уклоняйтесь от Dash (линия), Slam (конус) и Summon (круг).

4. **Перки**: При левел-апе выбирайте перки в зависимости от стиля игры:
   - **Оружие** — для увеличения урона и скорости атаки
   - **Выживание** — для увеличения HP и защиты
   - **Рыцарское искусство** — для улучшения рывка и специальных способностей

5. **Инвентарь**: Управляйте 3 слотами оружия и 2 слотами расходников. Подбирайте лут с пола.

6. **Мини-карта**: Используйте мини-карту в HUD для навигации по подземелью.

### Продвинутые техники

- **Буфер атак**: Атаки можно буферизовать — нажмите J до окончания предыдущей атаки для мгновенной следующей.
- **Комбо**: Меч → Копьё → Арбалет для эффективного комбо.
- **Позиционирование**: Используйте стены для ограничения движения врагов.
- **Кулдауны**: Следите за индикаторами кулдаунов в HUD.

## Структура проекта

```
game/
  ├── __init__.py
  ├── main.py                 # Точка входа
  ├── core/                   # Основные системы
  │   ├── settings.py         # Настройки игры
  │   ├── events.py           # EventBus система
  │   ├── assets.py           # Менеджер ресурсов
  │   ├── scenes.py           # Управление сценами
  │   ├── loop.py             # Игровой цикл
  │   ├── timers.py           # Таймеры и кулдауны
  │   └── i18n.py             # Локализация
  ├── ecs/                    # Entity Component System
  │   ├── components.py       # Компоненты
  │   ├── entities.py         # Сущности
  │   └── systems.py          # Системы
  ├── world/                  # Генерация мира
  │   ├── tiles.py            # Типы тайлов
  │   ├── level.py            # Уровень подземелья
  │   └── dungeon_gen.py     # Генератор подземелий
  ├── gameplay/               # Игровая логика
  │   ├── player.py           # Игрок
  │   ├── enemies.py          # Враги и AI
  │   ├── combat.py           # Боевая система
  │   ├── hitboxes.py         # Точные хитбоксы
  │   ├── weapons/            # Система оружия
  │   ├── perks.py            # Система перков
  │   ├── pathfinding.py      # A* pathfinding
  │   ├── telegraphs.py      # Телеграфы босса
  │   ├── effects.py          # Визуальные эффекты
  │   ├── puddles.py          # Система луж
  │   ├── boss.py             # Система босса
  │   ├── loot.py             # Система лута
  │   ├── stats.py            # Статистика забега
  │   └── scene.py            # Игровая сцена
  ├── ui/                     # Интерфейс
  │   ├── hud.py              # HUD
  │   ├── menus.py             # Меню
  │   ├── inventory.py        # Инвентарь
  │   ├── perk_selection.py   # Выбор перков
  │   ├── tutorial.py         # Обучение
  │   └── dialogs.py          # Диалоги
  ├── data/                   # Данные игры
  │   ├── config/              # Конфигурация
  │   └── balance/             # Баланс (JSON)
  ├── save/                   # Система сохранений
  │   └── manager.py
  └── tools/                   # Инструменты разработки
      └── json_to_csv.py       # Конвертер баланса

tests/                        # Тесты (pytest)
requirements.txt              # Зависимости
pyproject.toml                # Конфигурация Black и Ruff
```

## Особенности

- **ECS архитектура** — гибкая система сущностей и компонентов
- **EventBus** — система событий для слабой связанности
- **Генерация подземелий** — процедурная генерация уровней (BSP)
- **Боевая система** — механика боя с уроном, критами и эффектами
- **Точные хитбоксы** — frame-based окна урона для меча/копья, пробивание для снарядов
- **AI система** — поведенческие деревья для врагов, A* pathfinding
- **Система перков** — 3 ветки (Оружие, Выживание, Рыцарство) с редкостью
- **Система лута** — предметы и инвентарь
- **UI система** — HUD, меню, инвентарь, мини-карта
- **Фиксированный timestep** — стабильная физика и логика
- **Локализация** — поддержка EN/RU
- **Телеграфы босса** — визуальные индикаторы атак с миганием

## Разработка

### Форматирование кода

Проект использует Black и Ruff для форматирования и линтинга:

```bash
# Форматирование
black game/

# Линтинг
ruff check game/
```

### Тестирование

Запуск тестов:

```bash
pytest tests/ -v
```

Тесты покрывают:
- Генерацию подземелий (связность, покрытие комнат)
- Боевые формулы (крит, броня, frame-based урон)
- Систему перков (рост параметров, стеки)
- Сериализацию сохранений (round-trip)

### Типизация

Проект использует типизацию Python (typing) для лучшей читаемости и поддержки IDE.

### Баланс игры

Параметры баланса хранятся в `data/balance/*.json`:
- `weapons.json` — параметры оружия и модификаторы
- `enemies.json` — параметры врагов
- `skills.json` — перки и их формулы

Для редактирования используйте инструмент конвертации:

```bash
# JSON → CSV (для редактирования в Excel)
python tools/json_to_csv.py data/balance/weapons.json

# CSV → JSON (после редактирования)
python tools/json_to_csv.py data/balance/weapons.csv
```

## Сборка

### Создание исполняемого файла (PyInstaller)

Для создания standalone исполняемого файла:

```bash
# Windows
python tools/build.py

# Linux/macOS
python3 tools/build.py
```

Скрипт создаст:
- `dist/game.exe` (Windows) или `dist/game` (Linux/macOS)
- Папку `dist/data/` с ресурсами игры

Все файлы из `data/` будут включены в сборку автоматически.

## Лицензия

MIT License — см. файл LICENSE.

## Примечания

Это полнофункциональный каркас игры с:
- ✅ ECS архитектурой
- ✅ Генерацией подземелий
- ✅ Боевой системой с точными хитбоксами
- ✅ AI врагов с pathfinding
- ✅ Системой перков и опыта
- ✅ UI (HUD, меню, инвентарь)
- ✅ Локализацией
- ✅ Системой сохранений
- ✅ Тестами

Для дальнейшей разработки можно добавить:
- Спрайты и звуки в `data/sprites/` и `data/sfx/`
- Больше типов врагов и предметов
- Больше уровней и механик
- Улучшения генерации подземелий
